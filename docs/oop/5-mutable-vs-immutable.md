# Иммутабельность vs мутабельность, защитное копирование

## Основные определения

| Термин                             | Определение                                                                           |
| ---------------------------------- | ------------------------------------------------------------------------------------- |
| **Иммутабельность (immutability)** | Свойство объекта, при котором **его состояние не может измениться** после создания.   |
| **Мутабельность (mutability)**     | Свойство объекта, допускающее **изменение его внутреннего состояния** после создания. |

---

## Иммутабельные объекты

Иммутабельный объект — это объект, который гарантированно не меняет значения своих полей после конструирования.
- Все поля final, нет сеттеров.
- Любое "изменение" возвращает новый объект, а не модифицирует старый.

Примеры стандартных иммутабельных классов в Java:
- String
- Все классы-обёртки примитивов (Integer, Long, Boolean, Double и т.д.)
- LocalDate, LocalTime, BigDecimal (в Java Time API).

### Преимущества иммутабельности

| Преимущество                         | Объяснение                                                    |
| ------------------------------------ | ------------------------------------------------------------- |
| **Потокобезопасность**               | Не нужно синхронизировать доступ, т.к. состояние не меняется. |
| **Предсказуемость**                  | Поведение проще — состояние не "плавает".                     |
| **Безопасность**                     | Объект нельзя подменить или испортить извне.                  |
| **Удобство кэширования и сравнения** | Можно безопасно использовать в `HashMap`, `Set`, кешах.       |

### Недостатки иммутабельности

| Недостаток                                                 | Комментарий                             |
| ---------------------------------------------------------- | --------------------------------------- |
| **Создание большого количества объектов**                  | Каждое изменение создаёт новый объект.  |
| **Неподходяща для больших структур с частыми изменениями** | Например, изменяемые коллекции быстрее. |

### Мутабельные объекты
Мутабельный объект можно менять после создания.

---

## Защитное копирование (Defensive Copying)
Defensive Copying — приём, защищающий объект от нежелательных изменений извне.
Используется, если класс содержит мутабельные поля (например, Date, List, Map и т.д.).

Пример

    public class Event {
        private final Date date;
    
        public Event(Date date) {
            this.date = new Date(date.getTime()); // копия при приёме
        }
    
        public Date getDate() {
            return new Date(date.getTime()); // копия при возврате
        }
    }

### Применение защитного копирования
| Где               | Зачем                                        |
| ----------------- | -------------------------------------------- |
| В конструкторах   | Чтобы не хранить внешние изменяемые ссылки   |
| В геттерах        | Чтобы не отдавать изменяемую ссылку наружу   |
| В сеттерах        | Чтобы не сохранить внешнюю изменяемую ссылку |
| В equals/hashCode | Чтобы не зависеть от меняющегося состояния   |

---

## Итог

- **Иммутабельность** — это гарантия, что объект не изменяется.
- **Мутабельность** — противоположное свойство, удобное для производительности.
- **Защитное копирование** — способ изолировать внутреннее состояние от внешнего мира при использовании мутабельных данных.
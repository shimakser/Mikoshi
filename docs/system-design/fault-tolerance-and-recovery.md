# Fault Tolerance & Recovery: Leader Election, Data Consistency, Distributed Transactions, PITR / Backup / Restore

---

## Leader Election

---

## Data Consistency

--- 

## Distribution transactions

**Распределённая транзакция** — транзакция, которая затрагивает более одного ресурса:
    - Несколько БД.
    - Несколько микросервисов.
    - БД + очередь сообщений + внешние API и т.д.
  
_Проблема:_ невозможно гарантировать атомарность, консистентность и изолированность так же просто, как в монолитной БД.

### Что важно учитывать при проектировании распределённой системы
1. Определение границ данных и ответственности
   - Разделение данных: какой сервис чем управляет?
   - Где хранятся source of truth — единственный авторитетный источник данных или информации, который считается наиболее точным и актуальным.
2. Возможные ошибки
   - Что произойдёт, если часть системы упадёт?
   - Как обрабатываются частичные сбои?
3. Устойчивость к сбоям
   - Ретрай-механизмы.
   - Идемпотентность операций (повтор одного действия ≠ дублирование).
4. Последовательность vs Консистентность
   - Нужна ли жёсткая согласованность (сразу везде)? Или eventual consistency (все узлы синхронизируются позже)?
5. Транзакционная стратегия
   - 2PC
   - Saga
   - Event-driven подход
6. Временные ограничения
   - Сколько времени допустимо для завершения операции?
   - Каковы SLA на уровне каждого сервиса?

### Основные способы реализации
   - Two-Phase Commit (2PC).
   - Saga Pattern.
   - Outbox Pattern + Message Broker.

### Паттерны и техники
1.  **Retry + Backoff**
      - Если операция не удалась — можно попробовать снова.
        - Backoff: задержка между попытками.
        - Jitter: рандомизация, чтобы избежать перегрузки.
2. **Dead Letter Queue (DLQ)**
      - Если сообщение не удалось обработать несколько раз — оно уходит в DLQ для анализа.
3. **Timeouts + Circuit Breaker**
      - Timeout: не ждём бесконечно ответа от зависимого сервиса.
      - Circuit Breaker: если сервис часто даёт сбои — временно "отключаем" его вызовы.

---

## PITR / Backup / Restore


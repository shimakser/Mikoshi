# Reliability & Resilience: Failover, Replication, Backpressure, Rate Limiting, Circuit Breaker, Graceful Degradation, Distributed Coordination, Health Checks

## Failover

---

## Replication

Копирование данных с одного узла (primary/master) на другие (replica/secondary) для повышения отказоустойчивости, доступности и производительности чтения.

1. Синхронная
    - Запись подтверждается только после успешного обновления всех реплик.
    - Гарантирует консистентность.
    - Высокая латентность, снижение доступности при отказе реплики.
2. Асинхронная
    - Primary пишет и сразу отвечает клиенту, а реплики догоняют.
    - Высокая производительность.
    - Возможна потеря данных при сбое primary.
3. Полусинхронная
    - Primary ждёт подтверждение хотя бы от одной реплики.
    - Компромисс между скоростью и консистентностью.

---

## Backpressure

---

## Rate Limiting

---

## Circuit Breaker

Шаблон устойчивости (resilience pattern), который предотвращает попытки обращения к внешним зависимостям (например, микросервисам, базам данных, API), если они временно недоступны или работают нестабильно.

### Проблемы, которые решает
1. Cascading Failures (каскадные отказы)
   Если один сервис зависает или падает, все клиенты продолжают слать к нему запросы → растет очередь → перегружается не только он, но и они.
2. Resource Exhaustion
   Повторные попытки обращения к медленно работающему сервису могут занять все потоки, ухудшив производительность.
3. Latency Increase
   Таймауты на каждой попытке создают цепочку задержек и сбоев по всей архитектуре.

### Принцип работы
1. Closed (замкнут)
    - Сервис работает стабильно, все запросы проходят.
      Если начинается рост ошибок, увеличивается счётчик отказов.
    - Переход в Open, если число/доля ошибок превышает порог.
2. Open (разомкнут)
    - Запросы немедленно отклоняются — нет попыток обратиться к зависимому сервису.
    - Обычно здесь используется fallback (например, кэш, заглушка, сообщение «сервис недоступен»).
    - Через заданное время (reset timeout) — переход в Half-Open.
3. Half-Open (полуоткрыт)
    - Тестовая фаза: ограниченное количество запросов пропускается.
    - Если они успешны — переход обратно в Closed.
    - Если ошибки продолжаются — снова в Open.

### Circuit Breaker vs Retry vs Rate Limiter
- Circuit Breaker — Прерывает поток запросов к сломанной зависимости.
- Retry — Повторяет запрос после ошибки.
- Rate Limiter — Контролирует скорость запросов (предотвращает DoS).

**Пример:** Netflix Hystrix, Resilience4j.

---

## Graceful Degradation

---

## Distributed Coordination

---

## Health Checks
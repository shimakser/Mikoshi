# Transactions in Spring

## Принцип работы транзакций в Spring

Spring реализует транзакции через AOP (Aspect-Oriented Programming)
- Когда вызывается метод, помеченный @Transactional, Spring создаёт прокси-обёртку.
- Прокси:
    1. Открывает транзакцию перед вызовом метода.
    2. Выполняет метод.
    3. Если не было исключения — делает commit.
    4. Если было исключение — делает rollback.
Это работает только при вызове через прокси, то есть метод должен вызываться извне (не из того же класса напрямую).

---

## Основная аннотация — @Transactional

- Может ставится как на весь класс, так и на отдельный метод.
- Все операции внутри @Transactional выполняются как единое целое.
- Не наследуется автоматически на уровне методов при наследовании классов. Это означает, что если аннотация стоит на методе в родительском классе, она не будет применяться к такому же методу в подклассе, если его явно не аннотировать. Однако если @Transactional указана на уровне класса (сервисного бина), то все методы этого класса и его подклассов (которые являются Spring бинами) по умолчанию будут иметь транзакционное поведение, если не переопределено на уровне методов.
- сли метод с @Transactional вызывается внутри того же класса — прокси не сработает.

### Параметры @Transactional

`@Transactional(
propagation = Propagation.REQUIRED,
isolation = Isolation.READ_COMMITTED,
timeout = 30,
readOnly = false,
rollbackFor = Exception.class
)`

- **readOnly** — Подсказывает, что внутри транзакции не будет изменений данных. Может оптимизировать работу Hibernate / драйвера.

---

## Как Spring выбирает менеджер транзакций

Через PlatformTransactionManager.В зависимости от типа хранилища:

| Хранилище                 | TransactionManager             |
| :------------------------ | :----------------------------- |
| JPA (Hibernate)           | `JpaTransactionManager`        |
| JDBC                      | `DataSourceTransactionManager` |
| MongoDB                   | `MongoTransactionManager`      |
| JMS                       | `JmsTransactionManager`        |
| Chained (комбинированный) | `ChainedTransactionManager`    |

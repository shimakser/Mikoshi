# Indexes

Объект БД, создаваемый с целью повышения производительности выборки данных.

`CREATE INDEX index_name ON table_name (column_name)`

### Плюсы
+ ускорение поиска и сортировки по определенному полю или набору полей.
+ обеспечение уникальности данных.

### Минусы
- требование дополнительного места на диске и в оперативной памяти и чем больше/длиннее ключ, тем больше размер индекса.
- замедление операций вставки, обновления и удаления записей, поскольку при этом приходится обновлять сами индексы.

---

## Виды индексов
1. **B-Tree Index** (основной тип)
   - По умолчанию в большинстве СУБД (PostgreSQL, MySQL, Oracle, MSSQL).
   - Быстрый поиск, сортировка, BETWEEN, LIKE 'abc%'.
   - Подходит для равенства (=), неравенства (<, >, BETWEEN), и сортировки (ORDER BY).
2. **Hash Index**
   - Доступен, например, в MySQL (MEMORY engine).
   - Быстрее на равенствах (=), но не поддерживает диапазоны (<, BETWEEN) и ORDER BY.
3. **Bitmap Index** (чаще в хранилищах данных — Oracle, ClickHouse)
   - Эффективен при малом числе уникальных значений (например, gender, status, yes/no).
   - Быстро работает при сложных фильтрах с AND, OR.
4. **GiST / GIN / SP-GiST / BRIN** (PostgreSQL-specific)
   - GIN (Generalized Inverted Index) — для JSONB, ARRAY, tsvector.
   - BRIN (Block Range Index) — для очень больших таблиц (много строк), когда данные отсортированы (например, лог-файлы по дате).
5. ##
   - Поддерживает полнотекстовый поиск (MATCH AGAINST, to_tsvector()).
   - Для поиска по текстам, статьям, комментариям и т.д.
6. **Composite Index (составной)**
   - Индекс по нескольким колонкам: CREATE INDEX idx_name ON table(col1, col2).
   - Важно: порядок колонок имеет значение (используется слева направо).
7. **Covering Index (покрывающий)**
   - Индекс, который содержит все нужные колонки запроса, т.е. данные берутся только из индекса, а не из таблицы — экономия IO.

---

## Типы индексов

1. По порядку сортировки:
   - упорядоченные — индексы, в которых элементы упорядочены;
   - возрастающие;
   - убывающие;
   - неупорядоченные — индексы, в которых элементы не упорядочены.
2. По источнику данных:
   - индексы по представлению (view);
   - индексы по выражениям.
3. По воздействию на источник данных:
   - кластерный
   - не кластерный
4. По структуре:
   - B*-деревья;
   - B+-деревья;
   - B-деревья;
   - Хэши.
5. По количественному составу:
   - простой индекс (индекс с одним ключом) — строится по одному полю;
   - составной — строится по нескольким полям при этом важен порядок их следования;
   - индекс с включенными столбцами — некластеризованный индекс, дополнительно содержащий еще и неключевые столбцы;
   - главный — индексный ключ, под управлением которого в данный момент находится набор данных.
6. По характеристике содержимого:
   - уникальный
   - плотный (NoSQL)
   - разреженный (NoSQL)
   - пространственный
   - составной пространственный
   - полнотекстовый (инвертированный)
   - хэш-индекс
   - битовый индекс (bitmap index)
   - обратный индекс (reverse index)
   - функциональный индекс, индекс по вычисляемому полю (function-based index)
   - первичный
   - вторичный
   - XML-индекс
7. По механизму обновления:
   - полностью перестраиваемый.
   - пополняемый (балансируемый).
8. По покрытию индексируемого содержимого:
   - полностью покрывающий (полный).
   - частичный (partial)
   - инкрементный (delta)
   - индекс реального времени (real-time index)
9. Индексы в кластерных системах:
   - глобальный — индекс по всему содержимому всех сегментов БД (shard).
   - сегментный — глобальный индекс по полю-сегментируемому ключу (shard key). Используется для быстрого определения сегмента, на котором хранятся данные в процессе маршрутизации запроса в кластере БД.
   - локальный — индекс по содержимому только одного сегмента БД.

---

## Как понять какие индексы нужны:

- Частые запросы по ID — Индекс по ID.
- WHERE user_id = ? AND created_at > ? — Составной индекс (user_id, created_at).
- LIKE 'abc%' — B-Tree подходит.
- LIKE '%abc%' — Full-text или pg_trgm в PostgreSQL.
- Частые ORDER BY created_at DESC — Индекс по created_at DESC.
- Фильтрация по is_active = true — Частичный или Bitmap индекс.
- Запрос по jsonb->>'key' — GIN индекс.
- Поиск по ключевым словам — Full-text индекс.
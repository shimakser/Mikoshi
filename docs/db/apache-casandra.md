# Apache Casandra

Распределенная, децентрализованная, масштабируемая и высокодоступная база данных с широкими столбцами.

---

## Структура

**Столбец** — Столбец представляет пару ключ-значение и служит основной единицей структуры данных.

**Row** — действует как контейнер для столбцов, на которые ссылается первичный ключ.

**Column Family** — Логический контейнер для данных, который аналогичен таблице в реляционных базах данных.

**Keyspace** — служит контейнером для таблиц, охватывающих один или несколько узлов. Аналог базы данных.

**Узел** — основной компонент, который хранит часть данных и участвует в обработке запросов. Относится к компьютерной системе, на которой работает экземпляр Cassandra. Узел может быть физическим хостом, экземпляром машины в облаке или даже контейнером Docker.

**Кластер** — Группа узлов, объединённых для совместной работы.

---

Первичный ключ однозначно идентифицирует каждую строку таблицы. 

В Cassandra первичный ключ состоит из двух частей:
- **PartitionKey** — обязательная часть первичного ключа. Определяет, на каком узле кластера будут храниться данные. Каждый узел отвечает за определённый диапазон токенов (например, Node 1: 0-100, Node 2: 101-200 и так далее).
- **ClusteringKey** — необязательная часть первичного ключа. Определяет, как строки внутри одной партиции будут упорядочены.
  SSTable (Sorted Strings Table): Основной формат хранения данных на диске. SSTables неизменяемы и оптимизированы для записи.
  Memtable: Данные сначала записываются в память (memtable) и затем периодически сбрасываются на диск в формате SSTable.
  Commit Log: Лог операций, записываемый для обеспечения отказоустойчивости. При сбое данные из лога можно восстановить.

---

**Фактор репликации** — Указывает, сколько копий данных будет храниться в кластере.

**CAP:** AP.

---

## Transactions & ACID
- Транзакции в классическом понимании ACID отсутствуют из-за архитектуры, ориентированной на масштабируемость и доступность (CAP-теорема).
- Поддерживает "легкие транзакции" (lightweight transactions, LWT) на основе протокола Paxos, которые обеспечивают атомарность и согласованность только для одиночных операций с использованием условных обновлений (compare-and-set).
- LWT обеспечивают изоляцию и атомарность на уровне одной строки, но не поддерживают полноценные многорядовые транзакции.
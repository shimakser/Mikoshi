# Thread Pool

Создание потока является затратной по времени и ресурсам операцией. Количество потоков, которое может быть запущено в рамках одного процесса также ограниченно. В Java был реализован механизм пула потоков (thread pool), который создаётся во время запуска приложения и в дальнейшем потоки для обработки запросов берутся и переиспользуются уже из него.

---

## ThreadPoolExecutor
Это класс в Java, предоставляющий реализацию интерфейса ExecutorService. Он управляет пулом рабочих потоков, которые могут параллельно выполнять отправленные задания.

### Некоторые ключевые особенности ThreadPoolExecutor
1. Thread pool management:  ThreadPoolExecutor управляет пулом рабочих потоков, которые могут параллельно выполнять присланные задания. Он содержит очередь, в которой хранятся задания, ожидающие выполнения.
2. Fine-tuning (Тонкая настройка): ThreadPoolExecutor предоставляет множество настраиваемых параметров и крючков расширения для тонкой настройки пула потоков. Например, можно задать размер ядра пула, максимальный размер пула, время ожидания и емкость рабочей очереди.
3. Thread safety (Безопасность потоков): ThreadPoolExecutor является потокобезопасным, что означает возможность одновременного доступа и изменения пула потоков несколькими потоками без необходимости внешней синхронизации.
4. Фреймворк Java Executors: Фреймворк предоставляет фабричные и вспомогательные методы для интерфейса Executor для создания пула потоков в Java. Вы можете использовать фабричные методы Executors для создания пула потоков с настройками по умолчанию или использовать конструктор ThreadPoolExecutor для создания пула потоков с пользовательскими настройками.

---

## Executor

### Фреймворк Executor, который позволяет создавать различные типы пула потоков
- Executor — упрощенный интерфейс пула, содержит один метод для передачи задачи на выполнение;
- ExecutorService — расширенный интерфейс пула, с возможностью завершения всех потоков;
- AbstractExecutorService — базовый класс пула, реализующий интерфейс ExecutorService;
- Executors — фабрика объектов связанных с пулом потоков, в том числе позволяет создать основные типы пулов;
- ThreadPoolExecutor — пул потоков с гибкой настройкой, может служить базовым классом для нестандартных пулов;
- ForkJoinPool — пул для выполнения задач типа ForkJoinTask.

Если очередь пула потоков заполнилась, то поданная задача будет «отклонена». Например - метод submit() у ThreadPoolExecutor выкидывает RejectedExecutionException, после которого вызывается RejectedExecutionHandler.

---

## Fork/Join Pool

Это пул потоков, преимущество которого состоит в том, что он работает на основе принципа WorkStealing, что дословно можно перевести как «кража работы». Когда один из потоков ForkJoinPool заканчивает свою работу, он берёт из общей очереди работ новую задачу. Это продолжается до тех пор, пока задачи не кончатся.

Ещё одной особенностью ForkJoinPool является то, что в него нельзя подать Callable или Runnable задачу. У него есть своя иерархия задач, наследуемая от абстрактного класса ForkJoinTask.

- fork() запускает асинхронно в отдельном потоке некоторую задачу. - join() позволяет дождаться завершения выполнения работы.
- invoke() передаёт задачу на выполнение в один из потоков данного пула.
# IP, DNS and Networks

## CIDR и подсети

Classless Inter-Domain Routing — это способ обозначения IP-диапазонов в формате IP/Prefix, например, 10.0.0.0/16.
Где _/16_ означает, что первые 16 бит зафиксированы, а остальные 16 можно использовать для хостов → это даёт 2^16 = 65536 IP-адресов.

CIDR позволяет гибко разбивать IP-пространство на подсети, что критично для:
- организации зон безопасности,
- контроля сетевого трафика,
- изоляции ресурсов.

### Пример
- 10.0.0.0/16  — общая сеть VPC
- 10.0.1.0/24  — подсеть под фронтенды
- 10.0.2.0/24  — подсеть под базы данных

**Почему важно:** умение спроектировать адресное пространство без конфликтов позволяет легко масштабироваться и избежать переездов сетей.

---

## DNS (внешний и внутренний)
   
Domain Name System — резолвит имена в IP-адреса.

### Бывает
- Внешний (Google DNS, Cloudflare): резолвит общедоступные имена.
- Внутренний (внутри VPC): разрешает service.namespace.svc.cluster.local.

### Важные детали
- TTL (Time To Live): определяет, сколько кэшировать ответ. Низкий TTL = больше запросов, выше свежесть.
- Кеширование: DNS может кэшироваться:
  - локально на машине,
  - на уровне OS,
  - на уровне приложения.

### Проблемы
- Неверный TTL может привести к stale-записям → микросервис не может найти другой сервис.
- Если внутренний DNS (например, kube-dns) не работает → "всё падает", потому что сервисы не могут найти друг друга.

---

## IP

- Private IP — IP, доступный только внутри VPC или приватной сети.
- Public IP — доступен из интернета.

### Архитектурные соображения
- Всё, что можно, держим на Private IP, и только через gateway публикуем наружу.

### Public IP должен быть
- у Load Balancer,
- у jump/bastion хостов.

### Безопасность
- Любой Public IP = потенциальная точка атаки.
- Утечка Public IP — риск несанкционированного доступа.

---

## NAT и NAT Gateway
   
Network Address Translation — позволяет приватным инстансам выходить в интернет, сохраняя их приватный IP.

- NAT скрывает исходный IP и подменяет его на публичный IP NAT Gateway.
- Только исходящие соединения: входящие блокируются → это повышает безопасность.

**Use case:** сервисы из приватной подсети качают зависимости или обращаются к внешнему API (например, AWS S3 или Docker Hub).
Важный момент: в AWS NAT Gateway стоит денег за каждый гигабайт трафика. В GCP и Azure аналогичные механизмы.
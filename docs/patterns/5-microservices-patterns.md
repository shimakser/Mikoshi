# Microservices patterns

---

## SAGA

Набор локальных транзакций. Каждая обновляет базу данных и публикует сообщение, инициируя следующую локальную транзакцию
в саге. Если транзакция завершилась неудачей, тогда сага запускает компенсирующие транзакции, которые откатывают
изменения, сделанные предшествующими локальными транзакциями.

Существует два способа координации саг:

1. Choreography — каждая транзакция публикует события, которые запускают транзакции в других сервисах.

   Плюсы:
    - Высокая производительность.
    - Все участники слабо связаны.
    - У одного шага могут быть несколько версий.

   Минусы:
    - Высокая сложность тестирования.
    - Высокая сложность для переноса старого монолита на Сагу.
    - может добавить циклическую зависимость между службами.

2. Orchestration — оркестратор говорит участникам, какие транзакции должны быть запущены.

   Плюсы:
    - позволяет избежать циклических зависимостей.
    - идеально подходит для больших и сложных систем микросервисов.
    - легче управлять откатами транзакций.

---

## Transactional Outbox

---

## 2pc

---

## Monolith vs Microservices

### Монолит

#### Плюсы
+ Проект небольшой или находится на стадии MVP.
+ Не нужно тратить время на размышления о межпроцессном взаимодействие.
+ Сквозные тесты.
+ Прост в развертывании.

#### Минусы
- Высокая связанность и дублирование при изменения.
- Почти нет изоляции.
- Надёжность.
- Масштабируемость.
- Недостаток гибкости.

### Микросервисы

#### Плюсы
+ Модульность, изоляция.
+ Микросервисы меньше и легче.
+ Быстрые компиляция и развёртывание.
+ Гибкость в технология.

#### Минусы
- Сложность взаимодействия сервисов.
- Тестирование сложнее.